<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InvestPro - Investment Dashboard</title>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        /* Main Container */
        .mobile-container {
            max-width: 380px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3), 0 0 0 2px rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* App Content */
        .app-content {
            height: 700px;
            overflow-y: auto;
            padding: 20px;
            color: white;
            scrollbar-width: none;
        }

        .app-content::-webkit-scrollbar {
            display: none;
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .top-icons {
            display: flex;
            gap: 15px;
        }

        .top-icons i {
            font-size: 20px;
            color: white;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
            cursor: pointer;
        }

        /* Banner */
        .banner {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .product-images {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }

        .product-img-placeholder {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 25px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 15px 5px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .action-btn:hover {
            transform: translateY(-5px);
        }

        .action-btn i {
            font-size: 24px;
            color: white;
            filter: drop-shadow(0 0 15px #ff6b6b);
            margin-bottom: 5px;
            display: block;
        }

        .action-btn span {
            font-size: 12px;
            color: white;
        }

        /* Product Card */
        .product-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .product-header {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .product-image {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 20px;
        }

        .product-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .product-info p {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 3px;
        }

        .badge {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: inline-block;
        }

        .invest-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Bottom Navigation */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-item {
            text-align: center;
            color: white;
            opacity: 0.7;
            transition: opacity 0.3s;
            cursor: pointer;
        }

        .nav-item.active {
            opacity: 1;
        }

        .nav-item i {
            font-size: 20px;
            display: block;
            margin-bottom: 5px;
        }

        .nav-item span {
            font-size: 12px;
        }

        /* Admin Panel Styles */
        .admin-panel {
            max-width: 1200px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 30px;
            color: white;
            margin-top: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .admin-title {
            font-size: 32px;
            font-weight: bold;
        }

        .admin-logout {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .admin-card h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th,
        .admin-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            margin: 2px;
        }

        .admin-btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-content h2 {
            color: white;
            margin-bottom: 20px;
        }

        .modal-content input,
        .modal-content select,
        .modal-content textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .modal-content input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Login Form */
        .login-form {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            max-width: 350px;
            width: 100%;
        }

        .login-form h2 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }

        .login-form input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .login-form button {
            width: 100%;
            padding: 15px;
            border-radius: 25px;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Main App Container -->
    <div id="app"></div>

    <script>
        // Firebase Configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyC4nik_P57h9Ks8ryj0pG2xYNX-ePXKXtY",
  authDomain: "shoes-shopping-app-6a1d3.firebaseapp.com",
  databaseURL: "https://shoes-shopping-app-6a1d3-default-rtdb.firebaseio.com",
  projectId: "shoes-shopping-app-6a1d3",
  storageBucket: "shoes-shopping-app-6a1d3.appspot.com",
  messagingSenderId: "816065792865",
  appId: "1:816065792865:web:b1d58fab547f98e4961320",
  measurementId: "G-7BVQVYSMDF"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // App State
        let currentUser = null;
        let currentUserData = null;
        let isAdmin = false;

        // Navigation Functions
        function showHome() {
            document.getElementById('app').innerHTML = renderHomePage();
            attachEventListeners();
        }

        function showProducts() {
            document.getElementById('app').innerHTML = renderProductsPage();
            attachEventListeners();
        }

        function showProfile() {
            document.getElementById('app').innerHTML = renderProfilePage();
            attachEventListeners();
        }

        function showLogin() {
            document.getElementById('app').innerHTML = renderLoginPage();
            attachEventListeners();
        }

        function showAdminPanel() {
            if (!isAdmin) return;
            document.getElementById('app').innerHTML = renderAdminPanel();
            attachAdminEventListeners();
            loadAdminData();
        }

        // Render Functions
        function renderHomePage() {
            return `
                <div class="mobile-container">
                    <div class="app-content">
                        <div class="top-bar">
                            <div class="logo">InvestPro</div>
                            <div class="top-icons">
                                <i class="fas fa-globe"></i>
                                <i class="fas fa-bell"></i>
                            </div>
                        </div>

                        <div class="banner">
                            <h3>Special Offers</h3>
                            <div class="product-images">
                                <div class="product-img-placeholder"></div>
                                <div class="product-img-placeholder"></div>
                                <div class="product-img-placeholder"></div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <div class="action-btn" onclick="showCheckIn()">
                                <i class="fas fa-calendar-check"></i>
                                <span>Check-In</span>
                            </div>
                            <div class="action-btn" onclick="showReferral()">
                                <i class="fas fa-users"></i>
                                <span>Referral</span>
                            </div>
                            <div class="action-btn" onclick="showRecharge()">
                                <i class="fas fa-wallet"></i>
                                <span>Recharge</span>
                            </div>
                            <div class="action-btn" onclick="showWithdraw()">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Withdraw</span>
                            </div>
                        </div>

                        <h3>New Products</h3>
                        <div id="products-list">
                            <!-- Products will be loaded here -->
                        </div>
                    </div>

                    <div class="bottom-nav">
                        <div class="nav-item active" onclick="showHome()">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </div>
                        <div class="nav-item" onclick="showProducts()">
                            <i class="fas fa-box"></i>
                            <span>Products</span>
                        </div>
                        <div class="nav-item" onclick="showPromotion()">
                            <i class="fas fa-chart-line"></i>
                            <span>Promotion</span>
                        </div>
                        <div class="nav-item" onclick="showProfile()">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProductsPage() {
            return `
                <div class="mobile-container">
                    <div class="app-content">
                        <div class="top-bar">
                            <div class="logo">Products</div>
                            <div class="top-icons">
                                <i class="fas fa-search"></i>
                                <i class="fas fa-filter"></i>
                            </div>
                        </div>

                        <div id="all-products-list">
                            <!-- All products will be loaded here -->
                        </div>
                    </div>

                    <div class="bottom-nav">
                        <div class="nav-item" onclick="showHome()">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </div>
                        <div class="nav-item active" onclick="showProducts()">
                            <i class="fas fa-box"></i>
                            <span>Products</span>
                        </div>
                        <div class="nav-item" onclick="showPromotion()">
                            <i class="fas fa-chart-line"></i>
                            <span>Promotion</span>
                        </div>
                        <div class="nav-item" onclick="showProfile()">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProfilePage() {
            return `
                <div class="mobile-container">
                    <div class="app-content">
                        <div class="top-bar">
                            <div class="logo">Profile</div>
                            <div class="top-icons">
                                <i class="fas fa-cog"></i>
                            </div>
                        </div>

                        <div class="profile-header" style="text-align: center; margin-bottom: 30px;">
                            <i class="fas fa-user-circle" style="font-size: 80px; margin-bottom: 15px;"></i>
                            <h3>${currentUserData?.name || 'User'}</h3>
                            <p>${currentUser?.email || ''}</p>
                        </div>

                        <div class="stats-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                            <div class="stat-card" style="background: rgba(255,255,255,0.15); border-radius: 20px; padding: 15px; text-align: center;">
                                <i class="fas fa-wallet" style="font-size: 30px; margin-bottom: 10px;"></i>
                                <h4>Balance</h4>
                                <p>$${currentUserData?.wallet || 0}</p>
                            </div>
                            <div class="stat-card" style="background: rgba(255,255,255,0.15); border-radius: 20px; padding: 15px; text-align: center;">
                                <i class="fas fa-chart-line" style="font-size: 30px; margin-bottom: 10px;"></i>
                                <h4>Total Invested</h4>
                                <p>$${currentUserData?.totalInvested || 0}</p>
                            </div>
                        </div>

                        <div class="menu-list">
                            <div class="menu-item" style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 15px; margin-bottom: 10px;" onclick="showTransactionHistory()">
                                <i class="fas fa-history"></i>
                                <span>Transaction History</span>
                                <i class="fas fa-chevron-right" style="margin-left: auto;"></i>
                            </div>
                            <div class="menu-item" style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 15px; margin-bottom: 10px;" onclick="showReferral()">
                                <i class="fas fa-users"></i>
                                <span>Referrals</span>
                                <i class="fas fa-chevron-right" style="margin-left: auto;"></i>
                            </div>
                            <div class="menu-item" style="display: flex; align-items: center; gap: 15px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 15px; margin-bottom: 10px;" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                                <i class="fas fa-chevron-right" style="margin-left: auto;"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bottom-nav">
                        <div class="nav-item" onclick="showHome()">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </div>
                        <div class="nav-item" onclick="showProducts()">
                            <i class="fas fa-box"></i>
                            <span>Products</span>
                        </div>
                        <div class="nav-item" onclick="showPromotion()">
                            <i class="fas fa-chart-line"></i>
                            <span>Promotion</span>
                        </div>
                        <div class="nav-item active" onclick="showProfile()">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLoginPage() {
            return `
                <div class="mobile-container" style="display: flex; justify-content: center; align-items: center; min-height: 700px;">
                    <div class="login-form">
                        <h2>Welcome Back</h2>
                        <input type="email" id="login-email" placeholder="Email">
                        <input type="password" id="login-password" placeholder="Password">
                        <button onclick="login()">Login</button>
                        <p style="text-align: center; margin-top: 15px;">
                            Don't have an account? <a href="#" onclick="showRegister()" style="color: #fff;">Register</a>
                        </p>
                    </div>
                </div>
            `;
        }

        function renderAdminPanel() {
            return `
                <div class="admin-panel">
                    <div class="admin-header">
                        <div class="admin-title">Admin Dashboard</div>
                        <div class="admin-logout" onclick="logout()">Logout</div>
                    </div>

                    <!-- Analytics Cards -->
                    <div class="admin-grid">
                        <div class="admin-card">
                            <h3>Total Users</h3>
                            <p style="font-size: 36px;" id="total-users">0</p>
                        </div>
                        <div class="admin-card">
                            <h3>Active Users</h3>
                            <p style="font-size: 36px;" id="active-users">0</p>
                        </div>
                        <div class="admin-card">
                            <h3>Total Investments</h3>
                            <p style="font-size: 36px;" id="total-investments">$0</p>
                        </div>
                        <div class="admin-card">
                            <h3>Pending Withdrawals</h3>
                            <p style="font-size: 36px;" id="pending-withdrawals">0</p>
                        </div>
                    </div>

                    <!-- Chart -->
                    <div class="admin-card" style="margin-bottom: 30px;">
                        <canvas id="analytics-chart"></canvas>
                    </div>

                    <!-- Tabs -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="admin-btn" onclick="showAdminTab('users')">Users</button>
                        <button class="admin-btn" onclick="showAdminTab('products')">Products</button>
                        <button class="admin-btn" onclick="showAdminTab('investments')">Investments</button>
                        <button class="admin-btn" onclick="showAdminTab('withdrawals')">Withdrawals</button>
                        <button class="admin-btn" onclick="showAdminTab('recharge')">Recharge</button>
                        <button class="admin-btn" onclick="showAdminTab('referrals')">Referrals</button>
                        <button class="admin-btn" onclick="showAdminTab('notifications')">Notifications</button>
                        <button class="admin-btn" onclick="showAdminTab('security')">Security</button>
                        <button class="admin-btn" onclick="showAdminTab('roles')">Roles</button>
                    </div>

                    <!-- Content Area -->
                    <div id="admin-content" class="admin-card">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            `;
        }

        // Authentication Functions
        function login() {
            const email = document.getElementById('login-email')?.value;
            const password = document.getElementById('login-password')?.value;

            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    return db.collection('users').doc(currentUser.uid).get();
                })
                .then((doc) => {
                    if (doc.exists) {
                        currentUserData = doc.data();
                        isAdmin = currentUserData.role === 'admin' || currentUserData.role === 'super-admin';
                        
                        if (isAdmin) {
                            showAdminPanel();
                        } else {
                            showHome();
                        }
                    }
                })
                .catch((error) => {
                    alert('Login failed: ' + error.message);
                });
        }

        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                currentUserData = null;
                isAdmin = false;
                showLogin();
            });
        }

        // Admin Functions
        function loadAdminData() {
            // Load users count
            db.collection('users').get().then((snapshot) => {
                document.getElementById('total-users').textContent = snapshot.size;
                
                // Active users (logged in within last 24h)
                const activeUsers = snapshot.docs.filter(doc => {
                    const lastLogin = doc.data().lastLogin?.toDate();
                    return lastLogin && (new Date() - lastLogin) < 86400000;
                }).length;
                document.getElementById('active-users').textContent = activeUsers;
            });

            // Load investments
            db.collection('investments').get().then((snapshot) => {
                let total = 0;
                snapshot.forEach(doc => total += doc.data().amount || 0);
                document.getElementById('total-investments').textContent = '$' + total;
            });

            // Load pending withdrawals
            db.collection('withdrawals').where('status', '==', 'pending').get().then((snapshot) => {
                document.getElementById('pending-withdrawals').textContent = snapshot.size;
            });

            // Initialize chart
            createAnalyticsChart();
        }

        function createAnalyticsChart() {
            const ctx = document.getElementById('analytics-chart')?.getContext('2d');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Daily Earnings',
                        data: [12, 19, 3, 5, 2, 3, 9],
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        backgroundColor: 'rgba(255, 255, 255, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white'
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'white'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'white'
                            }
                        }
                    }
                }
            });
        }

        function showAdminTab(tab) {
            const content = document.getElementById('admin-content');
            
            switch(tab) {
                case 'users':
                    loadUsersTable(content);
                    break;
                case 'products':
                    loadProductsTable(content);
                    break;
                case 'investments':
                    loadInvestmentsTable(content);
                    break;
                case 'withdrawals':
                    loadWithdrawalsTable(content);
                    break;
                case 'recharge':
                    loadRechargeTable(content);
                    break;
                case 'referrals':
                    loadReferralsTable(content);
                    break;
                case 'notifications':
                    loadNotificationsForm(content);
                    break;
                case 'security':
                    loadSecurityPanel(content);
                    break;
                case 'roles':
                    loadRolesPanel(content);
                    break;
            }
        }

        function loadUsersTable(container) {
            db.collection('users').get().then((snapshot) => {
                let html = `
                    <h3>User Management</h3>
                    <button class="admin-btn" onclick="showAddUserModal()" style="margin-bottom: 15px;">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Wallet</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                snapshot.forEach(doc => {
                    const user = doc.data();
                    html += `
                        <tr>
                            <td>${user.name || 'N/A'}</td>
                            <td>${user.email}</td>
                            <td>$${user.wallet || 0}</td>
                            <td>${user.role || 'user'}</td>
                            <td>
                                <span style="color: ${user.blocked ? '#ff6b6b' : '#51cf66'}">
                                    ${user.blocked ? 'Blocked' : 'Active'}
                                </span>
                            </td>
                            <td>
                                <button class="admin-btn" onclick="editUser('${doc.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="admin-btn" onclick="adjustBalance('${doc.id}')">
                                    <i class="fas fa-coins"></i>
                                </button>
                                <button class="admin-btn ${user.blocked ? 'admin-btn-danger' : ''}" 
                                        onclick="toggleUserBlock('${doc.id}', ${!user.blocked})">
                                    <i class="fas fa-${user.blocked ? 'check' : 'ban'}"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            });
        }

        function loadProductsTable(container) {
            db.collection('products').get().then((snapshot) => {
                let html = `
                    <h3>Product Management</h3>
                    <button class="admin-btn" onclick="showAddProductModal()" style="margin-bottom: 15px;">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Price</th>
                                <th>Daily Profit</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                snapshot.forEach(doc => {
                    const product = doc.data();
                    html += `
                        <tr>
                            <td>
                                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 10px;"></div>
                            </td>
                            <td>${product.name}</td>
                            <td>$${product.price}</td>
                            <td>$${product.dailyProfit}</td>
                            <td>${product.duration} days</td>
                            <td>
                                <span style="color: ${product.visible ? '#51cf66' : '#ff6b6b'}">
                                    ${product.visible ? 'Visible' : 'Hidden'}
                                </span>
                            </td>
                            <td>
                                <button class="admin-btn" onclick="editProduct('${doc.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="admin-btn" onclick="toggleProductVisibility('${doc.id}', ${!product.visible})">
                                    <i class="fas fa-${product.visible ? 'eye-slash' : 'eye'}"></i>
                                </button>
                                <button class="admin-btn admin-btn-danger" onclick="deleteProduct('${doc.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            });
        }

        function loadWithdrawalsTable(container) {
            db.collection('withdrawals').where('status', '==', 'pending').get().then((snapshot) => {
                let html = `
                    <h3>Withdrawal Requests</h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    html += `
                        <tr>
                            <td>${withdrawal.userEmail}</td>
                            <td>$${withdrawal.amount}</td>
                            <td>${withdrawal.method}</td>
                            <td>${withdrawal.date?.toDate().toLocaleDateString()}</td>
                            <td>
                                <button class="admin-btn" onclick="approveWithdrawal('${doc.id}', '${withdrawal.userId}', ${withdrawal.amount})">
                                    Approve
                                </button>
                                <button class="admin-btn admin-btn-danger" onclick="rejectWithdrawal('${doc.id}')">
                                    Reject
                                </button>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            });
        }

        // Modal Functions
        function showAddUserModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'userModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Add New User</h2>
                    <input type="text" id="userName" placeholder="Full Name">
                    <input type="email" id="userEmail" placeholder="Email">
                    <input type="password" id="userPassword" placeholder="Password">
                    <select id="userRole">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                        <option value="finance-admin">Finance Admin</option>
                        <option value="support-admin">Support Admin</option>
                        <option value="product-manager">Product Manager</option>
                        <option value="viewer">Viewer</option>
                    </select>
                    <input type="number" id="initialBalance" placeholder="Initial Balance" value="0">
                    <div class="modal-buttons">
                        <button class="admin-btn" onclick="createUser()">Create</button>
                        <button class="admin-btn admin-btn-danger" onclick="closeModal('userModal')">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showAddProductModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'productModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>Add New Product</h2>
                    <input type="text" id="productName" placeholder="Product Name">
                    <input type="number" id="productPrice" placeholder="Price">
                    <input type="number" id="productDailyProfit" placeholder="Daily Profit">
                    <input type="number" id="productTotalIncome" placeholder="Total Income">
                    <input type="number" id="productDuration" placeholder="Duration (days)">
                    <div class="modal-buttons">
                        <button class="admin-btn" onclick="createProduct()">Create</button>
                        <button class="admin-btn admin-btn-danger" onclick="closeModal('productModal')">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.remove();
        }

        // CRUD Operations
        function createUser() {
            const name = document.getElementById('userName')?.value;
            const email = document.getElementById('userEmail')?.value;
            const password = document.getElementById('userPassword')?.value;
            const role = document.getElementById('userRole')?.value;
            const balance = parseFloat(document.getElementById('initialBalance')?.value) || 0;

            if (!email || !password) {
                alert('Please fill in all required fields');
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    return db.collection('users').doc(userCredential.user.uid).set({
                        name: name || email.split('@')[0],
                        email: email,
                        role: role,
                        wallet: balance,
                        totalInvested: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        blocked: false
                    });
                })
                .then(() => {
                    closeModal('userModal');
                    loadUsersTable(document.getElementById('admin-content'));
                    alert('User created successfully');
                })
                .catch((error) => {
                    alert('Error creating user: ' + error.message);
                });
        }

        function createProduct() {
            const name = document.getElementById('productName')?.value;
            const price = parseFloat(document.getElementById('productPrice')?.value);
            const dailyProfit = parseFloat(document.getElementById('productDailyProfit')?.value);
            const totalIncome = parseFloat(document.getElementById('productTotalIncome')?.value);
            const duration = parseInt(document.getElementById('productDuration')?.value);

            if (!name || !price || !dailyProfit || !totalIncome || !duration) {
                alert('Please fill in all fields');
                return;
            }

            db.collection('products').add({
                name: name,
                price: price,
                dailyProfit: dailyProfit,
                totalIncome: totalIncome,
                duration: duration,
                visible: true,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                closeModal('productModal');
                loadProductsTable(document.getElementById('admin-content'));
                alert('Product created successfully');
            })
            .catch((error) => {
                alert('Error creating product: ' + error.message);
            });
        }

        function adjustBalance(userId) {
            const amount = prompt('Enter amount to add/subtract (use - for subtraction):');
            if (amount === null) return;

            const numAmount = parseFloat(amount);
            if (isNaN(numAmount)) {
                alert('Invalid amount');
                return;
            }

            db.collection('users').doc(userId).get()
                .then((doc) => {
                    if (!doc.exists) throw new Error('User not found');
                    const currentBalance = doc.data().wallet || 0;
                    return db.collection('users').doc(userId).update({
                        wallet: currentBalance + numAmount
                    });
                })
                .then(() => {
                    alert('Balance adjusted successfully');
                    loadUsersTable(document.getElementById('admin-content'));
                })
                .catch((error) => {
                    alert('Error adjusting balance: ' + error.message);
                });
        }

        function toggleUserBlock(userId, block) {
            db.collection('users').doc(userId).update({
                blocked: block
            })
            .then(() => {
                loadUsersTable(document.getElementById('admin-content'));
            })
            .catch((error) => {
                alert('Error updating user: ' + error.message);
            });
        }

        function toggleProductVisibility(productId, visible) {
            db.collection('products').doc(productId).update({
                visible: visible
            })
            .then(() => {
                loadProductsTable(document.getElementById('admin-content'));
            })
            .catch((error) => {
                alert('Error updating product: ' + error.message);
            });
        }

        function approveWithdrawal(withdrawalId, userId, amount) {
            // Update withdrawal status
            db.collection('withdrawals').doc(withdrawalId).update({
                status: 'approved',
                processedAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                // Deduct from user wallet
                return db.collection('users').doc(userId).get();
            })
            .then((doc) => {
                if (!doc.exists) throw new Error('User not found');
                const currentBalance = doc.data().wallet || 0;
                return db.collection('users').doc(userId).update({
                    wallet: currentBalance - amount
                });
            })
            .then(() => {
                loadWithdrawalsTable(document.getElementById('admin-content'));
                alert('Withdrawal approved');
            })
            .catch((error) => {
                alert('Error approving withdrawal: ' + error.message);
            });
        }

        function rejectWithdrawal(withdrawalId) {
            db.collection('withdrawals').doc(withdrawalId).update({
                status: 'rejected',
                processedAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                loadWithdrawalsTable(document.getElementById('admin-content'));
                alert('Withdrawal rejected');
            })
            .catch((error) => {
                alert('Error rejecting withdrawal: ' + error.message);
            });
        }

        // Event Listeners
        function attachEventListeners() {
            // Load products if on home page
            if (document.getElementById('products-list')) {
                loadProducts();
            }
            if (document.getElementById('all-products-list')) {
                loadAllProducts();
            }
        }

        function attachAdminEventListeners() {
            // Admin specific listeners
        }

        // Load products for home page
        function loadProducts() {
            db.collection('products').where('visible', '==', true).limit(3).get()
                .then((snapshot) => {
                    const container = document.getElementById('products-list');
                    if (!container) return;

                    let html = '';
                    snapshot.forEach(doc => {
                        const product = doc.data();
                        html += `
                            <div class="product-card">
                                <div class="product-header">
                                    <div class="product-image"></div>
                                    <div class="product-info">
                                        <h3>${product.name}</h3>
                                        <p>Daily Profit: $${product.dailyProfit}</p>
                                        <p>Total Income: $${product.totalIncome}</p>
                                        <p>Price: $${product.price}</p>
                                        <span class="badge">${product.duration} Days</span>
                                    </div>
                                </div>
                                <button class="invest-btn" onclick="invest('${doc.id}')">Invest Now</button>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                });
        }

        function loadAllProducts() {
            db.collection('products').where('visible', '==', true).get()
                .then((snapshot) => {
                    const container = document.getElementById('all-products-list');
                    if (!container) return;

                    let html = '';
                    snapshot.forEach(doc => {
                        const product = doc.data();
                        html += `
                            <div class="product-card">
                                <div class="product-header">
                                    <div class="product-image"></div>
                                    <div class="product-info">
                                        <h3>${product.name}</h3>
                                        <p>Daily Profit: $${product.dailyProfit}</p>
                                        <p>Total Income: $${product.totalIncome}</p>
                                        <p>Price: $${product.price}</p>
                                        <span class="badge">${product.duration} Days</span>
                                    </div>
                                </div>
                                <button class="invest-btn" onclick="invest('${doc.id}')">Invest Now</button>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                });
        }

        function invest(productId) {
            if (!currentUser) {
                alert('Please login to invest');
                showLogin();
                return;
            }

            db.collection('products').doc(productId).get()
                .then((doc) => {
                    if (!doc.exists) throw new Error('Product not found');
                    const product = doc.data();

                    if (currentUserData.wallet < product.price) {
                        alert('Insufficient balance');
                        return;
                    }

                    // Create investment
                    return db.collection('investments').add({
                        userId: currentUser.uid,
                        productId: productId,
                        productName: product.name,
                        amount: product.price,
                        dailyProfit: product.dailyProfit,
                        totalIncome: product.totalIncome,
                        duration: product.duration,
                        status: 'active',
                        startDate: firebase.firestore.FieldValue.serverTimestamp(),
                        endDate: new Date(Date.now() + product.duration * 24 * 60 * 60 * 1000)
                    });
                })
                .then(() => {
                    // Deduct from wallet
                    return db.collection('users').doc(currentUser.uid).update({
                        wallet: currentUserData.wallet - product.price,
                        totalInvested: (currentUserData.totalInvested || 0) + product.price
                    });
                })
                .then(() => {
                    alert('Investment successful!');
                    showHome();
                })
                .catch((error) => {
                    alert('Error investing: ' + error.message);
                });
        }

        // Navigation functions
        function showCheckIn() {
            alert('Check-In feature coming soon!');
        }

        function showReferral() {
            alert('Referral feature coming soon!');
        }

        function showRecharge() {
            alert('Recharge feature coming soon!');
        }

        function showWithdraw() {
            alert('Withdraw feature coming soon!');
        }

        function showPromotion() {
            alert('Promotion feature coming soon!');
        }

        function showRegister() {
            alert('Registration feature coming soon!');
        }

        function showTransactionHistory() {
            alert('Transaction history coming soon!');
        }

        // Check authentication state
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                db.collection('users').doc(user.uid).get()
                    .then((doc) => {
                        if (doc.exists) {
                            currentUserData = doc.data();
                            isAdmin = currentUserData.role === 'admin' || currentUserData.role === 'super-admin';
                            
                            // Update last login
                            db.collection('users').doc(user.uid).update({
                                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            if (isAdmin) {
                                showAdminPanel();
                            } else {
                                showHome();
                            }
                        } else {
                            // Create user document if it doesn't exist
                            db.collection('users').doc(user.uid).set({
                                email: user.email,
                                name: user.email.split('@')[0],
                                wallet: 0,
                                totalInvested: 0,
                                role: 'user',
                                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                blocked: false
                            }).then(() => {
                                currentUserData = {
                                    email: user.email,
                                    name: user.email.split('@')[0],
                                    wallet: 0,
                                    totalInvested: 0,
                                    role: 'user'
                                };
                                isAdmin = false;
                                showHome();
                            });
                        }
                    });
            } else {
                showLogin();
            }
        });

        // Make functions globally available
        window.showHome = showHome;
        window.showProducts = showProducts;
        window.showProfile = showProfile;
        window.showLogin = showLogin;
        window.showAdminPanel = showAdminPanel;
        window.showCheckIn = showCheckIn;
        window.showReferral = showReferral;
        window.showRecharge = showRecharge;
        window.showWithdraw = showWithdraw;
        window.showPromotion = showPromotion;
        window.showRegister = showRegister;
        window.showTransactionHistory = showTransactionHistory;
        window.login = login;
        window.logout = logout;
        window.showAdminTab = showAdminTab;
        window.showAddUserModal = showAddUserModal;
        window.showAddProductModal = showAddProductModal;
        window.closeModal = closeModal;
        window.createUser = createUser;
        window.createProduct = createProduct;
        window.adjustBalance = adjustBalance;
        window.toggleUserBlock = toggleUserBlock;
        window.toggleProductVisibility = toggleProductVisibility;
        window.approveWithdrawal = approveWithdrawal;
        window.rejectWithdrawal = rejectWithdrawal;
        window.invest = invest;
        window.editUser = (userId) => alert('Edit user feature coming soon!');
        window.editProduct = (productId) => alert('Edit product feature coming soon!');
        window.deleteProduct = (productId) => {
            if (confirm('Are you sure you want to delete this product?')) {
                db.collection('products').doc(productId).delete()
                    .then(() => {
                        loadProductsTable(document.getElementById('admin-content'));
                        alert('Product deleted');
                    })
                    .catch((error) => {
                        alert('Error deleting product: ' + error.message);
                    });
            }
        };
    </script>
</body>
</html>
